<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Synology NAS로 Docker GitLab 설치하기 | Halog</title><meta name=keywords content=","><meta name=description content="시작하며 DSM 7버전에서는 SVN과 GitLab을 패키지로 지원하지 않습니다.
그렇기 때문에 Docker를 이용하여 설치해야 합니다.
제 경우는 KT 공유기와 Synology NAS(220+)에 램 8기가를 추가한 상태입니다.
공유기 포트포워딩만 조금 다를 뿐 전체적인 방법은 동일할 것이라 생각됩니다.
GitLab을 쾌적하게 쓰시려면 최소 램 4기가 이상으로 설정하시는게 좋습니다. 해당 설정은 컨테이너 생성 후에도 편집이 가능하니 필요에 따라 조정하시면 됩니다.
알림
완성 후 GitLab Repository 주소 경로가 올바르지 않은 이슈가 있지만 아래와 같이 설정하면 사용하는데 이상은 없을 것이라 생각됩니다."><meta name=author content><link rel=canonical href=https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/><meta name=google-site-verification content="G-MXZP81P04W"><link rel=stylesheet as=style crossorigin href=https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.6/dist/web/static/pretendard.css><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://haservi.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://haservi.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://haservi.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://haservi.github.io/apple-touch-icon.png><link rel=mask-icon href=https://haservi.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1400973749140762" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RP5NDCM8J9"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-RP5NDCM8J9",{anonymize_ip:!1})}</script><meta property="og:title" content="Synology NAS로 Docker GitLab 설치하기"><meta property="og:description" content="시작하며 DSM 7버전에서는 SVN과 GitLab을 패키지로 지원하지 않습니다.
그렇기 때문에 Docker를 이용하여 설치해야 합니다.
제 경우는 KT 공유기와 Synology NAS(220+)에 램 8기가를 추가한 상태입니다.
공유기 포트포워딩만 조금 다를 뿐 전체적인 방법은 동일할 것이라 생각됩니다.
GitLab을 쾌적하게 쓰시려면 최소 램 4기가 이상으로 설정하시는게 좋습니다. 해당 설정은 컨테이너 생성 후에도 편집이 가능하니 필요에 따라 조정하시면 됩니다.
알림
완성 후 GitLab Repository 주소 경로가 올바르지 않은 이슈가 있지만 아래와 같이 설정하면 사용하는데 이상은 없을 것이라 생각됩니다."><meta property="og:type" content="article"><meta property="og:url" content="https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/"><meta property="og:image" content="https://haservi.github.io/images/nas-docker-gitlab-setting.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-02T23:22:38+09:00"><meta property="article:modified_time" content="2022-08-02T23:22:38+09:00"><meta property="og:site_name" content="Halog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://haservi.github.io/images/nas-docker-gitlab-setting.png"><meta name=twitter:title content="Synology NAS로 Docker GitLab 설치하기"><meta name=twitter:description content="시작하며 DSM 7버전에서는 SVN과 GitLab을 패키지로 지원하지 않습니다.
그렇기 때문에 Docker를 이용하여 설치해야 합니다.
제 경우는 KT 공유기와 Synology NAS(220+)에 램 8기가를 추가한 상태입니다.
공유기 포트포워딩만 조금 다를 뿐 전체적인 방법은 동일할 것이라 생각됩니다.
GitLab을 쾌적하게 쓰시려면 최소 램 4기가 이상으로 설정하시는게 좋습니다. 해당 설정은 컨테이너 생성 후에도 편집이 가능하니 필요에 따라 조정하시면 됩니다.
알림
완성 후 GitLab Repository 주소 경로가 올바르지 않은 이슈가 있지만 아래와 같이 설정하면 사용하는데 이상은 없을 것이라 생각됩니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://haservi.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Synology NAS로 Docker GitLab 설치하기","item":"https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Synology NAS로 Docker GitLab 설치하기","name":"Synology NAS로 Docker GitLab 설치하기","description":"시작하며 DSM 7버전에서는 SVN과 GitLab을 패키지로 지원하지 않습니다.\n그렇기 때문에 Docker를 이용하여 설치해야 합니다.\n제 경우는 KT 공유기와 Synology NAS(220+)에 램 8기가를 추가한 상태입니다.\n공유기 포트포워딩만 조금 다를 뿐 전체적인 방법은 동일할 것이라 생각됩니다.\nGitLab을 쾌적하게 쓰시려면 최소 램 4기가 이상으로 설정하시는게 좋습니다. 해당 설정은 컨테이너 생성 후에도 편집이 가능하니 필요에 따라 조정하시면 됩니다.\n알림\n완성 후 GitLab Repository 주소 경로가 올바르지 않은 이슈가 있지만 아래와 같이 설정하면 사용하는데 이상은 없을 것이라 생각됩니다.","keywords":["",""],"articleBody":"시작하며 DSM 7버전에서는 SVN과 GitLab을 패키지로 지원하지 않습니다.\n그렇기 때문에 Docker를 이용하여 설치해야 합니다.\n제 경우는 KT 공유기와 Synology NAS(220+)에 램 8기가를 추가한 상태입니다.\n공유기 포트포워딩만 조금 다를 뿐 전체적인 방법은 동일할 것이라 생각됩니다.\nGitLab을 쾌적하게 쓰시려면 최소 램 4기가 이상으로 설정하시는게 좋습니다. 해당 설정은 컨테이너 생성 후에도 편집이 가능하니 필요에 따라 조정하시면 됩니다.\n알림\n완성 후 GitLab Repository 주소 경로가 올바르지 않은 이슈가 있지만 아래와 같이 설정하면 사용하는데 이상은 없을 것이라 생각됩니다.\nDocker에 GitLab 설치 패키지 센터에서 도커 설치 먼저 패키지 센터에서 Docker를 설치합니다. 도커를 실행 후 레지스트리에서 gitlab 검색 후 gitlab/gitlab-ce를 설치합니다. 조금 시간이 지난 후 설치가 완료되면 해당 이미지를 실행합니다. 도커 이미지 실행 및 설정하기 도커를 이미지를 실행 하면 다음과 같이 설정을 진행해야 합니다.\n먼저 고급 설정에서 자동 재시작 활성화를 합니다. 이렇게 되면 NAS가 죽었다 살아나도 알아서 실행됩니다. 포트 설정을 해줍니다. 로컬 포트는 임의로 해도 되지만 컨테이너 포트는 꼭 맞춰주셔야 합니다. 그리고 도커의 볼륨을 추가합니다. 공식홈페이지처럼 컨테이너 볼륨에 저장되는 정보를 NAS 로컬 위치로 매핑 시켜줍니다. 이렇게 설정 후 적용을 하면 컨테이너가 만들어 졌습니다. 해당 컨테이너가 결국은 하나의 GitLab을 구동하기 위한 서버라고 보시면 됩니다. 기본적으로 GitLab의 슈퍼관리자 아이디는 root이며, 패스워드는 방금 설정한 config 폴더의 initial_root_paasword파일에 암호가 있습니다.\n해당 암호를 보기 위해선 패키지 센터에서 텍스트 편집기를 설치하신 후 열어주시면 됩니다.\n패스워드를 확인 후 아래와 같이 컨테이너를 실행해주고 GitLab이 빌드(3~5분 정도)가 되면 접속이 가능합니다. 일단 이렇게 설정하시면 도커를 이용한 GitLab 설치는 정상적으로 끝났습니다.\n만약 해당 컴퓨터에서만 쓰실 경우는 NAS가 연결된 상태에서 해당 LAN IP로 접속해도 이용은 가능합니다.\n그렇지만 NAS를 쓰는 목적이 어디에서든 접속 가능하기 위함이니.. 조금 더 진행해주셔야 합니다.\nHTTP 설정을 하지 않고 바로 HTTPS로 넘어가셔도 무방합니다.\nHTTP 설정 및 공유기 포트포워딩 일단 NAS를 쓰시는 분들은 기본적으로 할당받을 수 있는 QuickConnectId가 있습니다. 해당 도메인 주소를 통해 우리는 외부에서 나의 NAS에 접속할 수 있습니다.\n하지만 보안상 아무나 이러한 접근을 허용하면 안되죠. 그렇기에 NAS의 설정에서 방화벽 규칙을 허용해줘야 하며, 공유기에서도 해당 포트로 접근 시 NAS에서 허용한 포트로 포트포워딩을 해줘야 합니다.\nNAS 방화벽 허용하기 제어판에서 방화벽에 들어간 후 규칙편집을 선택합니다. 방화벽 규칙을 생성합니다. 내장된 응용 프로그램 목록에서 선택에서 선택을 눌러주세요. 방금 전 만든 GitLab 컨테이너 포트를 선택합니다. 활성화 여부를 체크하고 확인을 눌러주세요. 여기까지 진행됐다면 NAS에 공유기를 물려서 사용하시는 분은 해당 공유기에서 NAS DNS로 접속하시면 접속이 되는 것을 확인 할 수 있습니다.\n공유기 포트포워딩 적용 제 경우는 KT 홈 허브 공유기가 있기에 해당 설정에 맞춰서 정리 하겠습니다.\n일단 IpTime과 달리 허브 기기의 관리자 페이지에 접속하기 위해선 공유기 와이파이 망 내 또는 랜선을 통해 웹페이지에서 172.30.1.254 로 접속해야 합니다.\n해당 화면에 처음 접속한 경우 기본 아이디와 패스워드는 아래와 같습니다.\n1 2 3 4 5 6 구형 ID: ktuser PW: megaap 신형 ID: ktuser PW: homehub 로그인 후 패스워드는 변경해주시는게 좋습니다. 추후 비밀번호를 잊어버리면 초기화하면 됩니다.\n먼저 UPnP(Universal Plug and Play) 설정을 해제하겠습니다. UPnP가 있으면 한번 포트 연결이 되면 이후에 포트포워딩을 지워도 적용됩니다. 편리한 기술이지만 보안에 취약한 문제가 있습니다.\n포트 포워딩 설정은 장치설정 -\u003e 트래픽 관리 -\u003e 포트 포워딩 설정으로 접근하면 됩니다.\n여기서 중요한 값은 외부포트, 내부 IP 주소, 내부 포트 입니다. 외부에서 들어오는 포트 주소입니다. 해당 포트로 들어오면 허브가 내부 포트로 포트를 변경해줍니다.\n외부포트는 임의로 정해도 되며, 내부 포트는 처음 Docker 컨테이너 포트에서 선택했던 포트 값을 지정해주면 됩니다.\n내부 IP 주소는 NAS에 연결된 내부 IP 주소를 입력해주면 됩니다.\n이렇게 설정하시면 이제 http는 어디서든 접속이 가능합니다.\nHTTPS 적용 및 역방향 프록시 설정 HTTPS를 적용할 예정이면 위으 포트포워딩에 443 포트만 적용하면 됩니다. NAS에서는 역방향 프록시 설정을 할 수 있습니다.\n그렇기 때문에 기존에 할당 받은 도메인에 여러 서브도메인을 설정할 수 있습니다.\n티스토리로 예를 들면 tistory.com은 하나의 도메인이지만 각각의 사용자는 앞에 user.tistory.com 식으로 자신의 도메인을 할당 받을 수 있는 원리와 비슷하다고 보면 됩니다.\n역방향 프록시 설정 역방향 프록시 설정 화면으로 이동합니다. 역방향 프록시 규칙을 설정합니다. 소스는 외부에서 접근하는 도메인 주소로 보시면 됩니다. 호스트이름 앞에 원하는 서브도메인을 입력하고 해당 도메인주소를 연결합니다. 대상은 기존 도메인주소와 도커 HTTP 컨테이너 포트를 입력합니다. 공유기 포트포워딩을 통해 HTTPS 포트인 443 포트를 허용해줍니다. NAS 인증서 발급 이제 외부에서 접속은 가능합니다. 하지만 HTTPS에서는 해당 도메인주소가 인증된 주소인지 확인하기 위해 인증서 발급이 필요합니다.\n일반적으로는 openssl 또는 사설 인증서를 이용하여 인증서를 발급받아야 하지만 NAS에서는 해당 과정 없이 간편하게 인증서를 발급받을 수 있습니다.\n제어판 -\u003e 보안 -\u003e 인증서로 이동후 추가를 눌러줍니다. 새인증서를 추가합니다. 인증서 이름과 Let’s Encrypt에서 인증서 얻기를 선택합니다. 역방향 프록시로 지정한 도메인 주소를 적습니다. 이메일은 본인의 이메일을 선택하시면 됩니다. 인증서 화면에서 설정에 들어가서 해당 인증서를 역방향 프록시에서 지정한 도메인과 매칭시킵니다. 모든 설정이 끝났습니다. 이렇게 하면 외부에서도 HTTPS로 접속이 가능합니다.\n기타 GitLab 프로젝트 생성 시 Clone with SSH와 Clone with HTTP의 주소가 프로젝트 레포지토리 주소와 매칭되지 않은 현상이 있습니다.\nGITLAB_HOST설정도 해보고, external_url도 지정해봤는데 제대로 되지 않아서 임시적으로 Clone with HTTP를 커스텀하는 방법(링크)이 있습니다.\n관리자로 로그인 후 좌측 메뉴에서 Admin을 선택합니다. Setting -\u003e General -\u003e Visibility and access controls 로 이동합니다. 해당 항목 중 Custom Git clone URL for HTTP(S) 의 값을 HTTPS로 인증한 도메인 주소로 추가합니다. ","wordCount":"767","inLanguage":"ko","image":"https://haservi.github.io/images/nas-docker-gitlab-setting.png","datePublished":"2022-08-02T23:22:38+09:00","dateModified":"2022-08-02T23:22:38+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/"},"publisher":{"@type":"Organization","name":"Halog","logo":{"@type":"ImageObject","url":"https://haservi.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://haservi.github.io/ accesskey=h title="Halog (Alt + H)">Halog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://haservi.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://haservi.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://haservi.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://haservi.github.io/>홈</a>&nbsp;»&nbsp;<a href=https://haservi.github.io/posts/>Posts</a></div><h1 class=post-title>Synology NAS로 Docker GitLab 설치하기</h1><div class=post-meta><span title='2022-08-02 23:22:38 +0900 +0900'>8월 2, 2022</span>&nbsp;·&nbsp;4 분</div></header><figure class=entry-cover><img loading=lazy srcset="https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/images/nas-docker-gitlab-setting_hu01257301aa780ea9dfb51771f3b4f0ef_28228_360x0_resize_box_3.png 360w ,https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/images/nas-docker-gitlab-setting_hu01257301aa780ea9dfb51771f3b4f0ef_28228_480x0_resize_box_3.png 480w ,https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/images/nas-docker-gitlab-setting_hu01257301aa780ea9dfb51771f3b4f0ef_28228_720x0_resize_box_3.png 720w ,https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/images/nas-docker-gitlab-setting_hu01257301aa780ea9dfb51771f3b4f0ef_28228_1080x0_resize_box_3.png 1080w ,https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/images/nas-docker-gitlab-setting.png 1280w" sizes="(min-width: 768px) 720px, 100vw" src=https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/images/nas-docker-gitlab-setting.png alt width=1280 height=720><p><text></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><ul><li><a href=#%ec%8b%9c%ec%9e%91%ed%95%98%eb%a9%b0 aria-label=시작하며>시작하며</a></li><li><a href=#docker%ec%97%90-gitlab-%ec%84%a4%ec%b9%98 aria-label="Docker에 GitLab 설치">Docker에 GitLab 설치</a><ul><li><a href=#%ed%8c%a8%ed%82%a4%ec%a7%80-%ec%84%bc%ed%84%b0%ec%97%90%ec%84%9c-%eb%8f%84%ec%bb%a4-%ec%84%a4%ec%b9%98 aria-label="패키지 센터에서 도커 설치">패키지 센터에서 도커 설치</a></li><li><a href=#%eb%8f%84%ec%bb%a4-%ec%9d%b4%eb%af%b8%ec%a7%80-%ec%8b%a4%ed%96%89-%eb%b0%8f-%ec%84%a4%ec%a0%95%ed%95%98%ea%b8%b0 aria-label="도커 이미지 실행 및 설정하기">도커 이미지 실행 및 설정하기</a></li></ul></li><li><a href=#http-%ec%84%a4%ec%a0%95-%eb%b0%8f-%ea%b3%b5%ec%9c%a0%ea%b8%b0-%ed%8f%ac%ed%8a%b8%ed%8f%ac%ec%9b%8c%eb%94%a9 aria-label="HTTP 설정 및 공유기 포트포워딩">HTTP 설정 및 공유기 포트포워딩</a><ul><li><a href=#nas-%eb%b0%a9%ed%99%94%eb%b2%bd-%ed%97%88%ec%9a%a9%ed%95%98%ea%b8%b0 aria-label="NAS 방화벽 허용하기">NAS 방화벽 허용하기</a></li><li><a href=#%ea%b3%b5%ec%9c%a0%ea%b8%b0-%ed%8f%ac%ed%8a%b8%ed%8f%ac%ec%9b%8c%eb%94%a9-%ec%a0%81%ec%9a%a9 aria-label="공유기 포트포워딩 적용">공유기 포트포워딩 적용</a></li></ul></li><li><a href=#https-%ec%a0%81%ec%9a%a9-%eb%b0%8f-%ec%97%ad%eb%b0%a9%ed%96%a5-%ed%94%84%eb%a1%9d%ec%8b%9c-%ec%84%a4%ec%a0%95 aria-label="HTTPS 적용 및 역방향 프록시 설정">HTTPS 적용 및 역방향 프록시 설정</a><ul><li><a href=#%ec%97%ad%eb%b0%a9%ed%96%a5-%ed%94%84%eb%a1%9d%ec%8b%9c-%ec%84%a4%ec%a0%95 aria-label="역방향 프록시 설정">역방향 프록시 설정</a></li><li><a href=#nas-%ec%9d%b8%ec%a6%9d%ec%84%9c-%eb%b0%9c%ea%b8%89 aria-label="NAS 인증서 발급">NAS 인증서 발급</a></li><li><a href=#%ea%b8%b0%ed%83%80 aria-label=기타>기타</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=시작하며>시작하며<a hidden class=anchor aria-hidden=true href=#시작하며>#</a></h2><p>DSM 7버전에서는 SVN과 GitLab을 패키지로 지원하지 않습니다.<br>그렇기 때문에 Docker를 이용하여 설치해야 합니다.</p><p>제 경우는 KT 공유기와 Synology NAS(220+)에 램 8기가를 추가한 상태입니다.<br>공유기 포트포워딩만 조금 다를 뿐 전체적인 방법은 동일할 것이라 생각됩니다.</p><p>GitLab을 쾌적하게 쓰시려면 최소 램 4기가 이상으로 설정하시는게 좋습니다. 해당
설정은 컨테이너 생성 후에도 편집이 가능하니 필요에 따라 조정하시면 됩니다.</p><style type=text/css>.notice{--root-color:#000;--root-background:#e7f2fa;--title-color:#fff;--title-background:#6ab0de;--warning-title:rgba(217, 83, 79, 0.9);--warning-content:#fae2e2;--info-title:#f0b37e;--info-content:#fff2db;--note-title:#6ab0de;--note-content:#e7f2fa;--tip-title:rgba(92, 184, 92, 0.8);--tip-content:#e6f9e6}body.dark .notice{--root-color:#fff;--root-background:#e7f2fa;--title-color:#fff;--title-background:#6ab0de;--warning-title:rgba(130, 49, 47, 0.9);--warning-content:#341312;--info-title:#906B4B;--info-content:#392A1E;--note-title:#3f6985;--note-content:#192A35;--tip-title:rgba(46, 92, 46, 0.8);--tip-content:#122412}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--root-color);background:var(--root-background)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background)}.notice.warning .notice-title{background:var(--warning-title)}.notice.warning{background:var(--warning-content)}.notice.info .notice-title{background:var(--info-title)}.notice.info{background:var(--info-content)}.notice.note .notice-title{background:var(--note-title)}.notice.note{background:var(--note-content)}.notice.tip .notice-title{background:var(--tip-title)}.notice.tip{background:var(--tip-content)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="note-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-notice" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-notice" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg></div><div class="notice info"><p class="first notice-title"><span class="icon-notice baseline"><svg><use href="#info-notice"/></svg></span>알림</p><p>완성 후 GitLab Repository 주소 경로가 올바르지 않은 이슈가 있지만 <a href=#%EA%B8%B0%ED%83%80>아래</a>와 같이 설정하면
사용하는데 이상은 없을 것이라 생각됩니다.</p></div><h2 id=docker에-gitlab-설치>Docker에 GitLab 설치<a hidden class=anchor aria-hidden=true href=#docker에-gitlab-설치>#</a></h2><h3 id=패키지-센터에서-도커-설치>패키지 센터에서 도커 설치<a hidden class=anchor aria-hidden=true href=#패키지-센터에서-도커-설치>#</a></h3><ol><li>먼저 패키지 센터에서 Docker를 설치합니다.</li><li>도커를 실행 후 레지스트리에서 <code>gitlab</code> 검색 후 <code>gitlab/gitlab-ce</code>를 설치합니다.
<img loading=lazy src=./images/image01.png alt=image></li><li>조금 시간이 지난 후 설치가 완료되면 해당 이미지를 실행합니다.
<img loading=lazy src=./images/image02.png alt=image></li></ol><h3 id=도커-이미지-실행-및-설정하기>도커 이미지 실행 및 설정하기<a hidden class=anchor aria-hidden=true href=#도커-이미지-실행-및-설정하기>#</a></h3><p>도커를 이미지를 실행 하면 다음과 같이 설정을 진행해야 합니다.</p><ol><li>먼저 고급 설정에서 <code>자동 재시작 활성화</code>를 합니다. 이렇게 되면 NAS가 죽었다 살아나도
알아서 실행됩니다.
<img loading=lazy src=./images/image03.png alt=image></li><li>포트 설정을 해줍니다. 로컬 포트는 임의로 해도 되지만 컨테이너 포트는 꼭 맞춰주셔야 합니다.
<img loading=lazy src=./images/image04.png alt=image></li><li>그리고 도커의 볼륨을 추가합니다. <a href=https://docs.gitlab.com/ee/install/docker.html>공식홈페이지</a>처럼 컨테이너 볼륨에 저장되는 정보를 NAS 로컬 위치로 매핑 시켜줍니다.
<img loading=lazy src=./images/image05.png alt=image></li><li>이렇게 설정 후 적용을 하면 컨테이너가 만들어 졌습니다. 해당 컨테이너가 결국은 하나의 GitLab을 구동하기 위한 서버라고 보시면 됩니다.
<img loading=lazy src=./images/image06.png alt=image></li></ol><p>기본적으로 GitLab의 슈퍼관리자 아이디는 <code>root</code>이며, 패스워드는 방금 설정한 <code>config</code> 폴더의 <code>initial_root_paasword</code>파일에 암호가 있습니다.</p><p>해당 암호를 보기 위해선 패키지 센터에서 <code>텍스트 편집기</code>를 설치하신 후 열어주시면 됩니다.<br><img loading=lazy src=./images/image07.png alt=image><br><img loading=lazy src=./images/image08.png alt=image></p><p>패스워드를 확인 후 아래와 같이 컨테이너를 실행해주고 GitLab이 빌드(3~5분 정도)가 되면 접속이 가능합니다.
<img loading=lazy src=./images/image09.png alt=image></p><p>일단 이렇게 설정하시면 도커를 이용한 GitLab 설치는 정상적으로 끝났습니다.<br>만약 해당 컴퓨터에서만 쓰실 경우는 NAS가 연결된 상태에서 해당 LAN IP로 접속해도 이용은 가능합니다.</p><p>그렇지만 NAS를 쓰는 목적이 어디에서든 접속 가능하기 위함이니.. 조금 더 진행해주셔야 합니다.<br><strong>HTTP 설정을 하지 않고 바로 HTTPS로 넘어가셔도 무방</strong>합니다.</p><h2 id=http-설정-및-공유기-포트포워딩>HTTP 설정 및 공유기 포트포워딩<a hidden class=anchor aria-hidden=true href=#http-설정-및-공유기-포트포워딩>#</a></h2><p>일단 NAS를 쓰시는 분들은 기본적으로 할당받을 수 있는 QuickConnectId가 있습니다. 해당 도메인 주소를 통해 우리는 외부에서 나의 NAS에 접속할 수 있습니다.</p><p>하지만 보안상 아무나 이러한 접근을 허용하면 안되죠. 그렇기에 NAS의 설정에서 방화벽 규칙을 허용해줘야 하며, 공유기에서도 해당 포트로 접근 시 NAS에서 허용한 포트로 포트포워딩을 해줘야 합니다.</p><h3 id=nas-방화벽-허용하기>NAS 방화벽 허용하기<a hidden class=anchor aria-hidden=true href=#nas-방화벽-허용하기>#</a></h3><ol><li>제어판에서 방화벽에 들어간 후 규칙편집을 선택합니다.
<img loading=lazy src=./images/image10.png alt=image></li><li>방화벽 규칙을 생성합니다.
<img loading=lazy src=./images/image11.png alt=image></li><li>내장된 응용 프로그램 목록에서 선택에서 선택을 눌러주세요.
<img loading=lazy src=./images/image12.png alt=image></li><li>방금 전 만든 GitLab 컨테이너 포트를 선택합니다.
<img loading=lazy src=./images/image13.png alt=image></li><li>활성화 여부를 체크하고 확인을 눌러주세요.
<img loading=lazy src=./images/image14.png alt=image></li></ol><p>여기까지 진행됐다면 NAS에 공유기를 물려서 사용하시는 분은 해당 공유기에서 NAS DNS로 접속하시면 접속이 되는 것을 확인 할 수 있습니다.<br><img loading=lazy src=./images/image15.png alt=image></p><h3 id=공유기-포트포워딩-적용>공유기 포트포워딩 적용<a hidden class=anchor aria-hidden=true href=#공유기-포트포워딩-적용>#</a></h3><p>제 경우는 KT 홈 허브 공유기가 있기에 해당 설정에 맞춰서 정리 하겠습니다.<br>일단 IpTime과 달리 허브 기기의 관리자 페이지에 접속하기 위해선 공유기 와이파이 망 내 또는 랜선을 통해 웹페이지에서 <code>172.30.1.254</code>
로 접속해야 합니다.</p><p><img loading=lazy src=./images/image16.png alt=image></p><p>해당 화면에 처음 접속한 경우 기본 아이디와 패스워드는 아래와 같습니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl>구형
</span></span><span class=line><span class=cl>ID: ktuser 
</span></span><span class=line><span class=cl>PW: megaap
</span></span><span class=line><span class=cl>신형
</span></span><span class=line><span class=cl>ID: ktuser
</span></span><span class=line><span class=cl>PW: homehub
</span></span></code></pre></td></tr></table></div></div><p>로그인 후 패스워드는 변경해주시는게 좋습니다. 추후 비밀번호를 잊어버리면 초기화하면 됩니다.</p><p>먼저 UPnP(Universal Plug and Play) 설정을 해제하겠습니다. UPnP가 있으면 한번 포트 연결이 되면 이후에 포트포워딩을 지워도
적용됩니다. 편리한 기술이지만 보안에 취약한 문제가 있습니다.</p><p><img loading=lazy src=./images/image17.png alt=image></p><p>포트 포워딩 설정은 장치설정 -> 트래픽 관리 -> 포트 포워딩 설정으로 접근하면 됩니다.</p><p><img loading=lazy src=./images/image18.png alt=image></p><p>여기서 중요한 값은 외부포트, 내부 IP 주소, 내부 포트 입니다.
외부에서 들어오는 포트 주소입니다. 해당 포트로 들어오면 허브가 내부 포트로 포트를 변경해줍니다.</p><p>외부포트는 임의로 정해도 되며, 내부 포트는 처음 Docker 컨테이너 포트에서 선택했던 포트 값을 지정해주면 됩니다.<br>내부 IP 주소는 NAS에 연결된 내부 IP 주소를 입력해주면 됩니다.</p><p><img loading=lazy src=./images/image19.png alt=image></p><p>이렇게 설정하시면 이제 http는 어디서든 접속이 가능합니다.</p><p><img loading=lazy src=./images/image20.png alt=image></p><h2 id=https-적용-및-역방향-프록시-설정>HTTPS 적용 및 역방향 프록시 설정<a hidden class=anchor aria-hidden=true href=#https-적용-및-역방향-프록시-설정>#</a></h2><p>HTTPS를 적용할 예정이면 위으 포트포워딩에 443 포트만 적용하면 됩니다. NAS에서는 역방향 프록시 설정을 할 수 있습니다.<br>그렇기 때문에 기존에 할당 받은 도메인에 여러 서브도메인을 설정할 수 있습니다.</p><p>티스토리로 예를 들면 tistory.com은 하나의 도메인이지만 각각의 사용자는 앞에 user.tistory.com 식으로 자신의 도메인을 할당 받을 수 있는
원리와 비슷하다고 보면 됩니다.</p><h3 id=역방향-프록시-설정>역방향 프록시 설정<a hidden class=anchor aria-hidden=true href=#역방향-프록시-설정>#</a></h3><ol><li>역방향 프록시 설정 화면으로 이동합니다.
<img loading=lazy src=./images/image21.png alt=image></li><li>역방향 프록시 규칙을 설정합니다. 소스는 외부에서 접근하는 도메인 주소로 보시면 됩니다. 호스트이름 앞에 원하는 서브도메인을 입력하고 해당 도메인주소를 연결합니다.
대상은 기존 도메인주소와 도커 HTTP 컨테이너 포트를 입력합니다.
<img loading=lazy src=./images/image22.png alt=image></li><li>공유기 포트포워딩을 통해 HTTPS 포트인 443 포트를 허용해줍니다.
<img loading=lazy src=./images/image23.png alt=image></li></ol><h3 id=nas-인증서-발급>NAS 인증서 발급<a hidden class=anchor aria-hidden=true href=#nas-인증서-발급>#</a></h3><p>이제 외부에서 접속은 가능합니다. 하지만 HTTPS에서는 해당 도메인주소가 인증된 주소인지 확인하기 위해 인증서 발급이 필요합니다.<br>일반적으로는 <strong>openssl</strong> 또는 <strong>사설 인증서</strong>를 이용하여 인증서를 발급받아야 하지만 NAS에서는 해당 과정 없이 간편하게 인증서를 발급받을 수 있습니다.</p><ol><li>제어판 -> 보안 -> 인증서로 이동후 추가를 눌러줍니다.
<img loading=lazy src=./images/image24.png alt=image></li><li>새인증서를 추가합니다.
<img loading=lazy src=./images/image25.png alt=image></li><li>인증서 이름과 Let&rsquo;s Encrypt에서 인증서 얻기를 선택합니다.
<img loading=lazy src=./images/image26.png alt=image></li><li>역방향 프록시로 지정한 도메인 주소를 적습니다. 이메일은 본인의 이메일을 선택하시면 됩니다.
<img loading=lazy src=./images/image27.png alt=image></li><li>인증서 화면에서 설정에 들어가서 해당 인증서를 역방향 프록시에서 지정한 도메인과 매칭시킵니다.
<img loading=lazy src=./images/image28.png alt=image></li></ol><p>모든 설정이 끝났습니다. 이렇게 하면 외부에서도 HTTPS로 접속이 가능합니다.</p><h3 id=기타>기타<a hidden class=anchor aria-hidden=true href=#기타>#</a></h3><p>GitLab 프로젝트 생성 시 Clone with SSH와 Clone with HTTP의 주소가 프로젝트 레포지토리 주소와 매칭되지 않은 현상이 있습니다.<br><code>GITLAB_HOST</code>설정도 해보고, external_url도 지정해봤는데 제대로 되지 않아서 임시적으로 Clone with HTTP를 커스텀하는 방법<a href=https://gitlab.com/gitlab-org/gitlab/-/merge_requests/18422>(링크)</a>이 있습니다.</p><ol><li>관리자로 로그인 후 좌측 메뉴에서 Admin을 선택합니다.</li><li>Setting -> General -> Visibility and access controls 로 이동합니다.</li><li>해당 항목 중 <code>Custom Git clone URL for HTTP(S)</code> 의 값을 HTTPS로 인증한 도메인 주소로 추가합니다.
<img loading=lazy src=./images/image29.png alt=image></li></ol></div><footer class=post-footer><ul class=post-tags></ul></footer><section class=comments><script>loadComment();function loadComment(){document.body.className.includes("dark")?theme="photon-dark":theme="boxy-light";let e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("repo","haservi/haservi.github.io"),e.setAttribute("issue-term","pathname"),e.setAttribute("theme",theme),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),document.querySelector("section.comments").innerHTML="",document.querySelector("section.comments").appendChild(e)}</script></section></article></main><footer class=footer><span>&copy; 2023 <a href=https://haservi.github.io/>Halog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,background:"#1d1e20",scrollOffset:40,container:null,template:null})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")),loadComment()})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>