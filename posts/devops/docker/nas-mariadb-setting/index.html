<!doctype html><html lang=ko dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Synology NAS Docker MariaDB 설치하기 | Halog</title><meta name=keywords content=","><meta name=description content="어느 날 NAS를 충분하게 이용하지 못한다는 생각이 문득 들었습니다.
우선 기존 앱에서 제공하는 Photos, 파일 저장소 정도만 이용하며, Docker Gitlab 서버 배포 중이긴 하지만.. 그냥 배포중 입니다.
이 정도도 충분하긴 하지만 조금 더 활용하면 좋지 않을까라는 생각을 하게 됐습니다.
문득 생각해 보니 NAS에서 Docker를 사용할 수 있다는 것은 개인적으로 운용할 수 있는 장난감 서버로 최적이지 않을까라는 생각이 들었습니다.
물론 아마도 많은 트래픽은 감당하지 못하더라도 개인적인 용도로 테스트 서버 정도는 만들 수 있지 않을까 생각됩니다."><meta name=author content><link rel=canonical href=https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/><meta name=google-site-verification content="G-MXZP81P04W"><link rel=stylesheet as=style crossorigin href=https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.6/dist/web/static/pretendard.css><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://haservi.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://haservi.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://haservi.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://haservi.github.io/apple-touch-icon.png><link rel=mask-icon href=https://haservi.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1400973749140762" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RP5NDCM8J9"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-RP5NDCM8J9",{anonymize_ip:!1})}</script><meta property="og:title" content="Synology NAS Docker MariaDB 설치하기"><meta property="og:description" content="어느 날 NAS를 충분하게 이용하지 못한다는 생각이 문득 들었습니다.
우선 기존 앱에서 제공하는 Photos, 파일 저장소 정도만 이용하며, Docker Gitlab 서버 배포 중이긴 하지만.. 그냥 배포중 입니다.
이 정도도 충분하긴 하지만 조금 더 활용하면 좋지 않을까라는 생각을 하게 됐습니다.
문득 생각해 보니 NAS에서 Docker를 사용할 수 있다는 것은 개인적으로 운용할 수 있는 장난감 서버로 최적이지 않을까라는 생각이 들었습니다.
물론 아마도 많은 트래픽은 감당하지 못하더라도 개인적인 용도로 테스트 서버 정도는 만들 수 있지 않을까 생각됩니다."><meta property="og:type" content="article"><meta property="og:url" content="https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/"><meta property="og:image" content="https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/images/cover.jpeg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-01T22:22:18+09:00"><meta property="article:modified_time" content="2024-01-01T22:22:18+09:00"><meta property="og:site_name" content="Halog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/images/cover.jpeg"><meta name=twitter:title content="Synology NAS Docker MariaDB 설치하기"><meta name=twitter:description content="어느 날 NAS를 충분하게 이용하지 못한다는 생각이 문득 들었습니다.
우선 기존 앱에서 제공하는 Photos, 파일 저장소 정도만 이용하며, Docker Gitlab 서버 배포 중이긴 하지만.. 그냥 배포중 입니다.
이 정도도 충분하긴 하지만 조금 더 활용하면 좋지 않을까라는 생각을 하게 됐습니다.
문득 생각해 보니 NAS에서 Docker를 사용할 수 있다는 것은 개인적으로 운용할 수 있는 장난감 서버로 최적이지 않을까라는 생각이 들었습니다.
물론 아마도 많은 트래픽은 감당하지 못하더라도 개인적인 용도로 테스트 서버 정도는 만들 수 있지 않을까 생각됩니다."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://haservi.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Synology NAS Docker MariaDB 설치하기","item":"https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Synology NAS Docker MariaDB 설치하기","name":"Synology NAS Docker MariaDB 설치하기","description":"어느 날 NAS를 충분하게 이용하지 못한다는 생각이 문득 들었습니다.\n우선 기존 앱에서 제공하는 Photos, 파일 저장소 정도만 이용하며, Docker Gitlab 서버 배포 중이긴 하지만.. 그냥 배포중 입니다.\n이 정도도 충분하긴 하지만 조금 더 활용하면 좋지 않을까라는 생각을 하게 됐습니다.\n문득 생각해 보니 NAS에서 Docker를 사용할 수 있다는 것은 개인적으로 운용할 수 있는 장난감 서버로 최적이지 않을까라는 생각이 들었습니다.\n물론 아마도 많은 트래픽은 감당하지 못하더라도 개인적인 용도로 테스트 서버 정도는 만들 수 있지 않을까 생각됩니다.","keywords":["",""],"articleBody":"어느 날 NAS를 충분하게 이용하지 못한다는 생각이 문득 들었습니다.\n우선 기존 앱에서 제공하는 Photos, 파일 저장소 정도만 이용하며, Docker Gitlab 서버 배포 중이긴 하지만.. 그냥 배포중 입니다.\n이 정도도 충분하긴 하지만 조금 더 활용하면 좋지 않을까라는 생각을 하게 됐습니다.\n문득 생각해 보니 NAS에서 Docker를 사용할 수 있다는 것은 개인적으로 운용할 수 있는 장난감 서버로 최적이지 않을까라는 생각이 들었습니다.\n물론 아마도 많은 트래픽은 감당하지 못하더라도 개인적인 용도로 테스트 서버 정도는 만들 수 있지 않을까 생각됩니다.\nNAS를 이용하면 기본적으로 도메인을 받을 수 있으며, DDNS 서비스를 제공하기에 조금 더 외부 접근에 대한 관리가 쉬울 것입니다.\n서비스를 만들 때 AWS를 이용하면 좋긴 합니다. 관리도 쉽고 트래픽의 요청이 많으면 자동화도 할 수 있고, 탄력적이고 확장성 있게 리소스를 조정할 수 있습니다.\n그렇지만 그만큼의 비용을 지불해야 합니다.\nNAS를 이용하면.. 전기세만 내면 개인적인 서비스를 구축할 수 있습니다..! 이후 안정화가 되거나 될 것 같은 서비스라고 판단되면 AWS나 Azure 이것도 아니라면 개인용 서버를 이용하여 환경을 구축하면 되지 않을까 생각합니다.\nNAS 소비 전력 계산 이참에 개인 양산형 NAS(DS220+)의 소비전력을 한번 계산 해보겠습니다.\nNAS가 없다면 NAS 구입 비용과 매달 내는 전기세를 계산해보고, NAS를 사용하지 않고 필요할 때 Cloud를 이용하는 것도 현명한 선택이라 생각됩니다.\nDS220+의 스펙을 확인해보니 전원 소비 값은 아래와 같더군요.\n최대값을 계산해보면 NAS: 15W, NAS용 하드디스크(4T): 4W~5W\n하드디스크가 2개들어가니 총 25W를 사용한다고 가정하면 한달 전기 소비량은\n25W x 24(시간) x 30(일) = 18000Wh = 18kWh 정도 되네요.\n네이버 전력 계산기에서는 18kWh만 넣으니 값이 이상해서 변화가 없을 정도로 미미한가 봅니다..\n한전 전기요금 계산기를 이용해 계산해보니 한달에 얼추 2천원이네요.\n23년 12월 기준 한달에 200kWh 미만을 사용하니 누진세도 없고.. 이 정도면.. NAS를 장난감으로 쓰는 것도 좋다고 생각합니다.\n사실 이러한 전기 요금에 대해 신경 쓰고 있지 않았지만, 궁금해서 계산해 봤습니다. :D..\nSSH 접속과 관련하여 NAS도 SSH로 접속하여 CMD창으로도 도커 이미지 및 컨테이너를 생성할 수 있습니다.\n공식 이미지가 아닌 경우는 위와 같은 방법으로 SSH 접속 포트(22는 위험하니 다른..)를 열고 방화벽(개인 접속 ip 한정으로)을 허용하여 작업할 수 도 있습니다.\n한번은 NAS 설정이 제대로 안돼서 방화벽을 한 5분 정도 열어두니 어디선가 NAS로 접근 요청이 들어와서 아래와 같이 경고 메일이 온 적도 있었습니다.\n그렇기 때문에 NAS SSH 접속 포트는 22번이 아닌 특정 값으로 하는 것이 좋으며, 공유기의 포트포워딩을 할 때에도 꼭 필요한 포트만 오픈하는 것이 안전합니다.\nDocker MariaDB 설치 NAS에서는 패키지 중에 Docker Container를 제공하며, 외부 도메인을 이용할 수 있기 때문에 마음만 먹으면 개인용 웹서버 및 DB 등 다양한 서비스를 구축할 수 있습니다.\n이와 관련하여 예전에 작성한 Synology NAS로 Docker GitLab 설치하기와 유사합니다.\n우선 패키지 센터에서 mariadb의 이미지를 등록합니다. SSH로 접속하여 실제 도커 허브에서도 받을 수 있고, 쉽게 레지스트리에서 이미지를 다운 받을 수도 있습니다.\n정상적으로 받은 경우 아래와 같이 도커의 이미지 항목에 MariaDB가 추가됩니다. 추가로 이미지는 버전은 latest 보다는 특정 버전을 명시하는 것이 좋다 생각합니다.\nlatest로 받게 되면 최신 버전을 사용할 수 있어서 새로운 기능과 보안 업데이트를 빠르게 받을 수 있는 장점이 있습니다. 그렇지만, “latest\"는 항상 최신 버전을 가리키기 때문에, 언제나 동일한 동작을 보장하지 않을 수 있습니다. 또한, 의존성이나 환경 설정이 변경될 수 있어 예기치 못한 문제가 발생할 수 있습니다.\n레지스트리에서 다운로드를 받은 뒤 아래와 같이 컨테이너를 생성해줍니다.\nDocker 내부의 포트는 기본포트로 3306을 지정하고, 외부에서 Docker로 접속하는 포트는 33306으로 지정했습니다.\n볼륨 설정의 값은 Docker DB에서 설정된 값을 NAS 저장소의 위치로 매핑시켜줍니다.\n데이터가 저장될 디렉터리를 생성(/docker/mariadb/data)하여 도커에 있는 /var/lib/mysql 저장 위치로 매핑하고, 마찬가지로 설정 파일이 저장될 위치도 생성(/docker/mariadb/config)한 뒤 도커에 있는 /etc/mysql/conf.d 로 저장되도록 설정합니다.\n컨테이너 환경은 기본적인 값은 설정돼 있습니다.\n아래와 같이 MYSQL_ROOT_PASSWORD 값을 지정해야 이후 컨테이너를 실행하면 root의 비밀번호로 로그인할 수 있습니다.\n만약 Timezone을 변경하고 싶다면 위와 같은 식으로 Key는 TZ 값은 Asia/Seoul로 지정하면 타임존을 한국시간(UTC-9)로 설정할 수 있습니다.\n이후 NAS를 통해 들어오는 방화벽을 허용해줍니다.\n만약 내부에서 쓰는 경우라면 공유기 포트포워딩이 필요없지만 외부로 사용할 경우에는 공유기도 포트포워딩이 필요합니다. 포트포워딩은 공유기 마다 다르기 때문에 설정이 다를 수 있습니다. 이전에 올린 Synology NAS로 Docker GitLab 설치하기에서 KT 공유기의 포트포워딩 방법도 함께 있으니 참고하시면 좋을 것 같습니다.\n이렇게 하시면 NAS를 이용해서 DB에 접속할 수 있습니다..!\n그런데 위와 같이 DB 설정을 마쳤지만, 간단한 데이터베이스 생성 및 테이블 생성하여 insert 테스트를 하니 생각보다 느린 현상이 있었습니다.\n장비의 문제인지 설정의 문제인지 정확하지 않지만 제 경우는 InnoDB 플러시 매개변수에서 innodb_flush_log_at_trx_commit의 기본값을 1에서 2로 변경했습니다.\n몇몇 답변으로는 innodb_buffer_pull 의 값을 변경하는 것이 좋다는 이야기도 있지만, 제 경우는 중요한 데이터를 저장하는게 아니라 위의 값을 수정하는 것으로 만족했습니다.\ninnodb_flush_log_at_trx_commit 이란 innodb_flush_log_at_trx_commit는 MySQL 데이터베이스의 InnoDB 스토리지 엔진에서 사용되는 설정 중 하나입니다.\n이 설정은 트랜잭션 커밋 시 로그 버퍼를 디스크에 언제 플러시할지를 결정합니다. 이 설정은 MySQL의 성능과 내구성 간의 트레이드오프를 조절하는 데 사용됩니다.\ninnodb_flush_log_at_trx_commit에는 세 가지 옵션이 있습니다\n0: 로그 버퍼는 트랜잭션 커밋 시마다 디스크에 플러시되지 않습니다. 대신 1초마다 한 번만 플러시됩니다. 이는 성능을 향상시킬 수 있지만, 시스템이 갑작스런 장애나 전원 손실로 인한 데이터 손실이 발생할 수 있습니다.\n1: 로그 버퍼는 각 트랜잭션 커밋 시마다 디스크에 플러시됩니다. 이는 데이터의 내구성을 높이지만, 플러시 작업이 성능에 영향을 미칠 수 있습니다.\n2: 로그 버퍼는 트랜잭션 커밋 시 디스크에 플러시되지 않습니다. 대신, 트랜잭션 데이터는 로그 파일 그룹에 쓰여질 때까지 메모리에 보관됩니다. 그 후 로그 파일 그룹은 주기적으로 디스크에 플러시됩니다. 이 옵션은 1과 0의 중간 지점으로 볼 수 있으며, 내구성을 높이면서도 일부 성능 향상을 제공할 수 있습니다.\n기본적으로 이 설정은 1로 설정되어 있습니다. 이 설정을 변경하려면 MySQL 설정 파일(my.cnf 또는 my.ini)에서 innodb_flush_log_at_trx_commit 값을 조정하고, MySQL을 재시작해야 합니다.\n이렇게 설정을 하면 아래와 같이 700ms -\u003e 5ms 로 insert 속도가 향상된 것을 확인할 수 있습니다.\n이렇게 NAS안에서 Docker를 이용해 DB Setting을 하는 방법에 대해 알아봤습니다.\n참고 NAS에서 느린 DB Insert 셋팅 설정 변경 NAS Dokcer MariaDB Insert 느린 이유(Stackoverflow) ","wordCount":"862","inLanguage":"ko","image":"https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/images/cover.jpeg","datePublished":"2024-01-01T22:22:18+09:00","dateModified":"2024-01-01T22:22:18+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/"},"publisher":{"@type":"Organization","name":"Halog","logo":{"@type":"ImageObject","url":"https://haservi.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://haservi.github.io/ accesskey=h title="Halog (Alt + H)">Halog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://haservi.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://haservi.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://haservi.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://haservi.github.io/>홈</a>&nbsp;»&nbsp;<a href=https://haservi.github.io/posts/>Posts</a></div><h1 class=post-title>Synology NAS Docker MariaDB 설치하기</h1><div class=post-meta><span title='2024-01-01 22:22:18 +0900 +0900'>1월 1, 2024</span>&nbsp;·&nbsp;5 분</div></header><figure class=entry-cover><img loading=lazy srcset="https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/images/cover_hu9221e89dfae0face8e4137d1b1d6f5cb_126531_360x0_resize_q75_box.jpeg 360w ,https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/images/cover_hu9221e89dfae0face8e4137d1b1d6f5cb_126531_480x0_resize_q75_box.jpeg 480w ,https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/images/cover_hu9221e89dfae0face8e4137d1b1d6f5cb_126531_720x0_resize_q75_box.jpeg 720w ,https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/images/cover.jpeg 1024w" sizes="(min-width: 768px) 720px, 100vw" src=https://haservi.github.io/posts/devops/docker/nas-mariadb-setting/images/cover.jpeg alt width=1024 height=576><p><text></p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>목차</span></summary><div class=inner><ul><ul><li><a href=#nas-%ec%86%8c%eb%b9%84-%ec%a0%84%eb%a0%a5-%ea%b3%84%ec%82%b0 aria-label="NAS 소비 전력 계산">NAS 소비 전력 계산</a></li><li><a href=#ssh-%ec%a0%91%ec%86%8d%ea%b3%bc-%ea%b4%80%eb%a0%a8%ed%95%98%ec%97%ac aria-label="SSH 접속과 관련하여">SSH 접속과 관련하여</a></li></ul><li><a href=#docker-mariadb-%ec%84%a4%ec%b9%98 aria-label="Docker MariaDB 설치">Docker MariaDB 설치</a><ul><li><a href=#innodb_flush_log_at_trx_commit-%ec%9d%b4%eb%9e%80 aria-label="innodb_flush_log_at_trx_commit 이란">innodb_flush_log_at_trx_commit 이란</a></li></ul></li><li><a href=#%ec%b0%b8%ea%b3%a0 aria-label=참고>참고</a></li></ul></div></details></div><div class=post-content><p>어느 날 NAS를 충분하게 이용하지 못한다는 생각이 문득 들었습니다.</p><p>우선 기존 앱에서 제공하는 <code>Photos</code>, <code>파일 저장소</code> 정도만 이용하며, Docker Gitlab 서버 배포 중이긴 하지만.. 그냥 배포중 입니다.<br>이 정도도 충분하긴 하지만 조금 더 활용하면 좋지 않을까라는 생각을 하게 됐습니다.</p><p>문득 생각해 보니 NAS에서 Docker를 사용할 수 있다는 것은 개인적으로 운용할 수 있는 장난감 서버로 최적이지 않을까라는 생각이 들었습니다.<br>물론 아마도 많은 트래픽은 감당하지 못하더라도 개인적인 용도로 테스트 서버 정도는 만들 수 있지 않을까 생각됩니다.</p><p>NAS를 이용하면 기본적으로 도메인을 받을 수 있으며, DDNS 서비스를 제공하기에 조금 더 외부 접근에 대한 관리가 쉬울 것입니다.</p><p>서비스를 만들 때 AWS를 이용하면 좋긴 합니다. 관리도 쉽고 트래픽의 요청이 많으면 자동화도 할 수 있고, 탄력적이고 확장성 있게 리소스를 조정할 수 있습니다.<br>그렇지만 그만큼의 비용을 지불해야 합니다.</p><p>NAS를 이용하면.. 전기세만 내면 개인적인 서비스를 구축할 수 있습니다..! 이후 안정화가 되거나 될 것 같은 서비스라고 판단되면 AWS나 Azure 이것도 아니라면 개인용
서버를 이용하여 환경을 구축하면 되지 않을까 생각합니다.</p><h3 id=nas-소비-전력-계산>NAS 소비 전력 계산<a hidden class=anchor aria-hidden=true href=#nas-소비-전력-계산>#</a></h3><p>이참에 개인 양산형 NAS(DS220+)의 소비전력을 한번 계산 해보겠습니다.</p><p>NAS가 없다면 NAS 구입 비용과 매달 내는 전기세를 계산해보고, NAS를 사용하지 않고 필요할 때 Cloud를 이용하는 것도 현명한 선택이라 생각됩니다.</p><p>DS220+의 <a href=https://global.synologydownload.com/download/Document/Hardware/ProductSpec/DiskStation/20-year/DS220%2B/krn/Product_Spec_DS220%2B_krn.pdf>스펙</a>을 확인해보니 전원 소비 값은 아래와 같더군요.</p><p><img loading=lazy src=./images/image01.png#center alt=image></p><p>최대값을 계산해보면 NAS: 15W, NAS용 하드디스크(4T): 4W~5W</p><p>하드디스크가 2개들어가니 총 25W를 사용한다고 가정하면 한달 전기 소비량은</p><p>25W x 24(시간) x 30(일) = 18000Wh = 18kWh 정도 되네요.</p><p>네이버 전력 계산기에서는 18kWh만 넣으니 값이 이상해서 변화가 없을 정도로 미미한가 봅니다..<br><a href=https://online.kepco.co.kr/PRM033D00>한전</a> 전기요금 계산기를 이용해 계산해보니 한달에 얼추 2천원이네요.</p><p><img loading=lazy src=./images/image02.png#center alt=image></p><p>23년 12월 기준 한달에 200kWh 미만을 사용하니 누진세도 없고.. 이 정도면.. NAS를 장난감으로 쓰는 것도 좋다고 생각합니다.<br>사실 이러한 전기 요금에 대해 신경 쓰고 있지 않았지만, 궁금해서 계산해 봤습니다. :D..</p><h3 id=ssh-접속과-관련하여>SSH 접속과 관련하여<a hidden class=anchor aria-hidden=true href=#ssh-접속과-관련하여>#</a></h3><p>NAS도 SSH로 접속하여 CMD창으로도 도커 이미지 및 컨테이너를 생성할 수 있습니다.<br>공식 이미지가 아닌 경우는 위와 같은 방법으로 SSH 접속 포트(22는 위험하니 다른..)를 열고 방화벽(개인 접속 ip 한정으로)을 허용하여 작업할 수 도 있습니다.</p><p>한번은 NAS 설정이 제대로 안돼서 방화벽을 한 5분 정도 열어두니 어디선가 NAS로 접근 요청이 들어와서 아래와 같이 경고 메일이 온 적도 있었습니다.</p><p><img loading=lazy src=./images/image03.png#center alt=image></p><p>그렇기 때문에 NAS SSH 접속 포트는 22번이 아닌 특정 값으로 하는 것이 좋으며, 공유기의 포트포워딩을 할 때에도 꼭 필요한 포트만 오픈하는 것이 안전합니다.</p><h2 id=docker-mariadb-설치>Docker MariaDB 설치<a hidden class=anchor aria-hidden=true href=#docker-mariadb-설치>#</a></h2><p>NAS에서는 패키지 중에 Docker Container를 제공하며, 외부 도메인을 이용할 수 있기 때문에 마음만 먹으면 개인용 웹서버 및 DB 등 다양한 서비스를 구축할 수 있습니다.</p><p>이와 관련하여 예전에 작성한 <a href=https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/>Synology NAS로 Docker GitLab 설치하기</a>와 유사합니다.</p><p>우선 패키지 센터에서 mariadb의 이미지를 등록합니다. SSH로 접속하여 실제 도커 허브에서도 받을 수 있고, 쉽게 레지스트리에서 이미지를 다운 받을 수도 있습니다.</p><p>정상적으로 받은 경우 아래와 같이 도커의 이미지 항목에 MariaDB가 추가됩니다. 추가로 이미지는 버전은 latest 보다는 특정 버전을 명시하는 것이 좋다 생각합니다.</p><p><img loading=lazy src=./images/image04.png#center alt=image></p><p>latest로 받게 되면 최신 버전을 사용할 수 있어서 새로운 기능과 보안 업데이트를 빠르게 받을 수 있는 장점이 있습니다. 그렇지만, &ldquo;latest"는 항상 최신 버전을 가리키기 때문에, 언제나 동일한 동작을 보장하지 않을 수 있습니다. 또한, 의존성이나 환경 설정이 변경될 수 있어 예기치 못한 문제가 발생할 수 있습니다.</p><p>레지스트리에서 다운로드를 받은 뒤 아래와 같이 컨테이너를 생성해줍니다.</p><p><img loading=lazy src=./images/image05.png#center alt=image></p><p>Docker 내부의 포트는 기본포트로 3306을 지정하고, 외부에서 Docker로 접속하는 포트는 33306으로 지정했습니다.</p><p>볼륨 설정의 값은 Docker DB에서 설정된 값을 NAS 저장소의 위치로 매핑시켜줍니다.<br>데이터가 저장될 디렉터리를 생성(<code>/docker/mariadb/data</code>)하여 도커에 있는 <code>/var/lib/mysql</code> 저장 위치로 매핑하고, 마찬가지로 설정 파일이 저장될 위치도 생성(<code>/docker/mariadb/config</code>)한 뒤 도커에 있는 <code>/etc/mysql/conf.d</code> 로 저장되도록 설정합니다.</p><p><img loading=lazy src=./images/image06.png#center alt=image></p><p>컨테이너 환경은 기본적인 값은 설정돼 있습니다.<br>아래와 같이 <code>MYSQL_ROOT_PASSWORD</code> 값을 지정해야 이후 컨테이너를 실행하면 root의 비밀번호로 로그인할 수 있습니다.<br>만약 Timezone을 변경하고 싶다면 위와 같은 식으로 Key는 <code>TZ</code> 값은 <code>Asia/Seoul</code>로 지정하면 타임존을 한국시간(UTC-9)로 설정할 수 있습니다.</p><p><img loading=lazy src=./images/image07.png#center alt=image></p><p>이후 NAS를 통해 들어오는 방화벽을 허용해줍니다.</p><p><img loading=lazy src=./images/image08.png#center alt=image></p><p>만약 내부에서 쓰는 경우라면 공유기 포트포워딩이 필요없지만 외부로 사용할 경우에는 공유기도 포트포워딩이 필요합니다. 포트포워딩은 공유기 마다 다르기 때문에 설정이 다를 수 있습니다. 이전에 올린 <a href=https://haservi.github.io/posts/devops/docker/nas-docker-gitlab-setting/>Synology NAS로 Docker GitLab 설치하기</a>에서 KT 공유기의 포트포워딩 방법도 함께 있으니 참고하시면 좋을 것 같습니다.</p><p>이렇게 하시면 NAS를 이용해서 DB에 접속할 수 있습니다..!</p><p><img loading=lazy src=./images/image09.png#center alt=image></p><p>그런데 위와 같이 DB 설정을 마쳤지만, 간단한 데이터베이스 생성 및 테이블 생성하여 insert 테스트를 하니 생각보다 느린 현상이 있었습니다.</p><p><img loading=lazy src=./images/image10.png#center alt=image></p><p>장비의 문제인지 설정의 문제인지 정확하지 않지만 제 경우는 InnoDB 플러시 매개변수에서 <code>innodb_flush_log_at_trx_commit</code>의 기본값을 1에서 2로 변경했습니다.</p><p>몇몇 답변으로는 <code>innodb_buffer_pull</code> 의 값을 변경하는 것이 좋다는 이야기도 있지만, 제 경우는 중요한 데이터를 저장하는게 아니라 위의 값을 수정하는 것으로 만족했습니다.</p><h3 id=innodb_flush_log_at_trx_commit-이란>innodb_flush_log_at_trx_commit 이란<a hidden class=anchor aria-hidden=true href=#innodb_flush_log_at_trx_commit-이란>#</a></h3><p>innodb_flush_log_at_trx_commit는 MySQL 데이터베이스의 InnoDB 스토리지 엔진에서 사용되는 설정 중 하나입니다.</p><p>이 설정은 트랜잭션 커밋 시 로그 버퍼를 디스크에 언제 플러시할지를 결정합니다. 이 설정은 MySQL의 성능과 내구성 간의 트레이드오프를 조절하는 데 사용됩니다.</p><p>innodb_flush_log_at_trx_commit에는 세 가지 옵션이 있습니다</p><ol><li><p>0: 로그 버퍼는 트랜잭션 커밋 시마다 디스크에 플러시되지 않습니다. 대신 1초마다 한 번만 플러시됩니다. 이는 성능을 향상시킬 수 있지만, 시스템이 갑작스런 장애나 전원 손실로 인한 데이터 손실이 발생할 수 있습니다.</p></li><li><p>1: 로그 버퍼는 각 트랜잭션 커밋 시마다 디스크에 플러시됩니다. 이는 데이터의 내구성을 높이지만, 플러시 작업이 성능에 영향을 미칠 수 있습니다.</p></li><li><p>2: 로그 버퍼는 트랜잭션 커밋 시 디스크에 플러시되지 않습니다. 대신, 트랜잭션 데이터는 로그 파일 그룹에 쓰여질 때까지 메모리에 보관됩니다. 그 후 로그 파일 그룹은 주기적으로 디스크에 플러시됩니다. 이 옵션은 1과 0의 중간 지점으로 볼 수 있으며, 내구성을 높이면서도 일부 성능 향상을 제공할 수 있습니다.</p></li></ol><p>기본적으로 이 설정은 1로 설정되어 있습니다. 이 설정을 변경하려면 MySQL 설정 파일(my.cnf 또는 my.ini)에서 innodb_flush_log_at_trx_commit 값을 조정하고, MySQL을 재시작해야 합니다.</p><p>이렇게 설정을 하면 아래와 같이 700ms -> 5ms 로 insert 속도가 향상된 것을 확인할 수 있습니다.</p><p><img loading=lazy src=./images/image11.png#center alt=image></p><p>이렇게 NAS안에서 Docker를 이용해 DB Setting을 하는 방법에 대해 알아봤습니다.</p><h2 id=참고>참고<a hidden class=anchor aria-hidden=true href=#참고>#</a></h2><ul><li><a href=https://stackoverflow.com/questions/52451930/very-slow-mysql-performance-on-nas>NAS에서 느린 DB Insert 셋팅 설정 변경</a></li><li><a href=https://stackoverflow.com/questions/57761895/insert-sql-query-very-slow-in-mariadb-docker-container-compared-to-xampp>NAS Dokcer MariaDB Insert 느린 이유(Stackoverflow)</a></li></ul></div><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-1400973749140762 data-ad-slot=9822233283></ins>
<script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><footer class=post-footer><ul class=post-tags></ul></footer><section class=comments><script>loadComment();function loadComment(){document.body.className.includes("dark")?theme="photon-dark":theme="boxy-light";let e=document.createElement("script");e.src="https://utteranc.es/client.js",e.setAttribute("repo","haservi/haservi.github.io"),e.setAttribute("issue-term","pathname"),e.setAttribute("theme",theme),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),document.querySelector("section.comments").innerHTML="",document.querySelector("section.comments").appendChild(e)}</script></section></article></main><footer class=footer><span>&copy; 2024 <a href=https://haservi.github.io/>Halog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".post-content img"));images.forEach(e=>{mediumZoom(e,{margin:0,background:"#1d1e20",scrollOffset:40,container:null,template:null})})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")),loadComment()})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="복사";function s(){t.innerHTML="복사 완료!",setTimeout(()=>{t.innerHTML="복사"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>